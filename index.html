<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#317EFB">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://accounts.google.com https://apis.google.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://www.googleapis.com; frame-src 'self' https://accounts.google.com;">
  <title>Court File Tracker</title>
  <link rel="manifest" href="manifest.json" type="application/manifest+json">
  <link rel="stylesheet" href="style.css">
  <!-- Google API Client Library for Drive Integration -->
  <script src="https://apis.google.com/js/api.js"></script>
  <!-- Google Sign-In Client Library -->
  <script src="https://accounts.google.com/gsi/client"></script>
  <!-- CryptoJS for Encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <!-- jsPDF for PDF Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Fuse.js for Search -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
  <!-- Chart.js for Dashboard Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <!-- EXIF.js for Image Orientation -->
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
</head>
<body>
  <!-- Top Header -->
  <header class="topbar" role="banner">
    <button id="menuBtn" aria-label="Toggle menu" onclick="toggleSidebar()">‚ò∞</button>
    <div class="top-title">
      <h1>Court File Tracker</h1>
      <p>Smart Solutions for Efficient Record Management</p>
    </div>
    <div class="window-controls" style="display: none;">
      <button id="minimizeBtn" class="window-btn minimize-btn" title="Minimize" aria-label="Minimize window">‚àí</button>
      <button id="resizeBtn" class="window-btn resize-btn" title="Maximize/Restore" aria-label="Maximize or restore window">‚ñ°</button>
      <button id="closeBtn" class="window-btn close-btn" title="Close" aria-label="Close window">‚úï</button>
    </div>
  </header>

  <!-- Main App Container -->
  <div class="app-container">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" role="navigation" aria-label="Main navigation">
      <div class="sidebar-overlay" onclick="toggleSidebar()" aria-hidden="true"></div>
      <img src="icons/icon-192.png" alt="Court File Tracker Logo" class="sidebar-logo">
      <button onclick="navigate('dashboard')" aria-label="Go to Dashboard"><span>üè†</span> Dashboard</button>
      <button onclick="navigate('newFile')" aria-label="Go to New File Entry"><span>üìÇ</span> New Entry</button>
      <button onclick="navigate('return')" aria-label="Go to Return File"><span>‚Ü©Ô∏è</span> Return File</button>
      <button onclick="navigate('fileFetcher')" aria-label="Go to File Fetcher"><span>üë§</span> File Fetcher</button>
      <button onclick="navigate('admin')" aria-label="Go to Admin"><span>üõ°Ô∏è</span> Admin</button>
      <button onclick="navigate('developersDisclaimer')" aria-label="Go to Developers Disclaimer"><span>‚ÑπÔ∏è</span> Developers Disclaimer</button>
      <button id="backupLink" onclick="backupToDrive()" aria-label="Backup to Google Drive"><span>üíæ</span> Backup to Google Drive</button>
      <button id="restoreLink" onclick="restoreFromDrive()" aria-label="Restore from Google Drive"><span>üîÑ</span> Restore from Google Drive</button>
      <button id="logoutLink" onclick="logout()" aria-label="Logout"><span>üö™</span> Logout</button>
    </aside>

    <!-- Main Screens -->
    <main id="main-content" role="main">
      <!-- Dashboard -->
      <section id="dashboard" class="screen" aria-labelledby="dashboard-heading">
        <h2 id="dashboard-heading">Dashboard Summary</h2>
        <div id="dashboardStats" style="margin-bottom: 20px;">
          <canvas id="statsChart" height="100" aria-label="Dashboard statistics chart"></canvas>
        </div>
        <div id="dashboardCards" class="dashboard-grid">
          <div class="card card-deliveries" id="cardDeliveries" role="button" aria-label="Files delivered today">
            <span class="tooltip">Files delivered today</span>
          </div>
          <div class="card card-returns" id="cardReturns" role="button" aria-label="Files returned today">
            <span class="tooltip">Files returned today</span>
          </div>
          <div class="card card-pending" id="cardPending" role="button" aria-label="Files not yet returned">
            <span class="tooltip">Files not yet returned</span>
          </div>
          <div class="card card-tomorrow" id="cardTomorrow" role="button" aria-label="Hearings scheduled for tomorrow">
            <span class="tooltip">Hearings scheduled for tomorrow</span>
          </div>
          <div class="card card-overdue" id="cardOverdue" role="button" aria-label="Files pending over 10 days">
            <span class="tooltip">Files pending over 10 days</span>
          </div>
          <div class="card card-search-prev" id="cardSearchPrev" role="button" aria-label="Search all previous records">
            <span class="tooltip">Search all previous records</span>
          </div>
        </div>

        <div id="dashboardReportPanel" style="display: none; margin-top: 20px;">
          <div id="loadingIndicator" class="loading" style="display: none;" aria-live="polite">Loading...</div>
          <h3 id="reportTitle" aria-live="assertive"></h3>
          <div id="searchPrevRecords" style="display: none; margin-bottom: 10px;">
            <div class="search-container">
              <label for="searchTitle">Title:
                <input type="text" id="searchTitle" placeholder="A Vs. B" oninput="performDashboardSearch()" aria-label="Search by case title">
              </label>
              <label for="searchCms">CMS No:
                <input type="number" id="searchCms" oninput="performDashboardSearch()" aria-label="Search by CMS number">
              </label>
              <label for="searchFileTaker">File Taker:
                <div class="input-container">
                  <input type="text" id="searchFileTaker" oninput="suggestProfiles(this.value, 'searchFileTaker')" autocomplete="off" aria-label="Search by file taker name">
                  <ul id="searchSuggestions" role="listbox" aria-label="File taker suggestions"></ul>
                </div>
              </label>
              <label for="searchFirNo">FIR No:
                <input type="text" id="searchFirNo" oninput="performDashboardSearch()" aria-label="Search by FIR number">
              </label>
              <label for="searchFirYear">FIR Year:
                <input type="number" id="searchFirYear" oninput="performDashboardSearch()" aria-label="Search by FIR year">
              </label>
              <label for="searchPoliceStation">Police Station:
                <input type="text" id="searchPoliceStation" oninput="performDashboardSearch()" aria-label="Search by police station">
              </label>
            </div>
          </div>
          <button onclick="printDashboardReport()" aria-label="Print dashboard report">Print</button>
          <button onclick="exportDashboardReport('csv')" aria-label="Export dashboard report to CSV">Export to CSV</button>
          <button onclick="exportDashboardReport('pdf')" aria-label="Export dashboard report to PDF">Export to PDF</button>
          <div class="table-container">
            <table id="dashboardReportTable" border="1" style="width: 100%; border-collapse: collapse;" aria-label="Dashboard report table">
              <thead>
                <tr>
                  <th scope="col">Sr#</th>
                  <th scope="col">CMS No</th>
                  <th scope="col">Title</th>
                  <th scope="col">Case Type</th>
                  <th scope="col">Nature</th>
                  <th scope="col">Criminal Details</th>
                  <th scope="col">Date Type</th>
                  <th scope="col">Swal Form Details</th>
                  <th scope="col">Delivered To</th>
                  <th scope="col">Delivery Date</th>
                  <th scope="col">Return Date</th>
                  <th scope="col">Time Span</th>
                  <th scope="col">Court</th>
                  <th scope="col">Clerk Name</th>
                  <th scope="col">Profile Details</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="pagination" style="margin-top: 10px; text-align: center;" role="navigation" aria-label="Table pagination">
            <button id="prevPage" disabled aria-label="Previous page">Previous</button>
            <span id="pageInfo" aria-live="polite"></span>
            <button id="nextPage" aria-label="Next page">Next</button>
          </div>
        </div>
      </section>

      <!-- New File Entry -->
      <section id="newFile" class="screen" aria-labelledby="newFile-heading">
        <h2 id="newFile-heading">New File Entry & Delivery</h2>
        <div id="loadingIndicator" class="loading" style="display: none;" aria-live="polite">Saving...</div>
        <form id="fileForm" aria-label="New file entry form">
          <label for="caseType">Case Type: <span class="required" aria-hidden="true">*</span>
            <select id="caseType" required onchange="toggleCriminalFields()" aria-required="true">
              <option value="">Select</option>
              <option value="civil">Civil</option>
              <option value="criminal">Criminal</option>
            </select>
          </label>
          <label for="cmsNo">CMS No: <span class="required" aria-hidden="true">*</span>
            <input type="number" id="cmsNo" required onblur="autoFillCMS()" aria-required="true">
          </label>
          <label for="petitioner">Petitioner: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="petitioner" required aria-required="true">
          </label>
          <label for="respondent">Respondent: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="respondent" required aria-required="true">
          </label>
          <label for="nature">Nature of Case: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="nature" required aria-required="true">
          </label>
          <div id="criminalFields" style="display: none;">
            <label for="firNo">FIR No: <input type="text" id="firNo"></label>
            <label for="firYear">FIR Year: <input type="number" id="firYear" min="1947"></label>
            <label for="firUs">FIR U/S: <input type="text" id="firUs"></label>
            <label for="policeStation">Police Station: <input type="text" id="policeStation"></label>
          </div>
          <label for="dateType">Date Type: <span class="required" aria-hidden="true">*</span>
            <select id="dateType" required aria-required="true">
              <option value="">Select</option>
              <option value="decision">Decision Date</option>
              <option value="hearing">Next Hearing Date</option>
            </select>
          </label>
          <label for="date">Date: <span class="required" aria-hidden="true">*</span>
            <input type="date" id="date" required aria-required="true">
          </label>
          <div class="input-container">
            <label for="deliveredTo">Delivered To (Name): <span class="required" aria-hidden="true">*</span>
              <input type="text" id="deliveredTo" oninput="suggestProfiles(this.value, 'deliveredTo')" required autocomplete="off" aria-required="true" aria-autocomplete="list">
              <ul id="suggestions" role="listbox" aria-label="Delivered to suggestions"></ul>
              <span class="hint" style="font-size: 12px; color: #555;">Edit profiles in the File Fetcher section.</span>
            </label>
          </div>
          <label for="deliveredType">Delivered To Type: <span class="required" aria-hidden="true">*</span>
            <select id="deliveredType" required aria-required="true">
              <option value="">Select</option>
              <option value="munshi">Munshi/Clerk</option>
              <option value="advocate">Advocate</option>
              <option value="colleague">Colleague</option>
              <option value="other">Other</option>
            </select>
          </label>
          <div class="copy-agency-row">
            <input type="checkbox" id="copyAgency" onchange="toggleCopyAgency()" aria-label="Sent to Copy Agency">
            <label for="copyAgency">Sent to Copy Agency</label>
          </div>
          <div id="copyAgencyFields" style="display: none;">
            <label for="swalFormNo">Swal Form No: <span class="required" aria-hidden="true">*</span>
              <input type="number" id="swalFormNo" aria-required="true">
            </label>
            <label for="swalDate">Swal Date: <span class="required" aria-hidden="true">*</span>
              <input type="date" id="swalDate" aria-required="true">
            </label>
          </div>
          <button type="submit" aria-label="Save and deliver file">Save and Deliver File</button>
        </form>
      </section>

      <!-- Return -->
      <section id="return" class="screen" aria-labelledby="return-heading">
        <h2 id="return-heading">Return File</h2>
        <div id="loadingIndicator" class="loading" style="display: none;" aria-live="polite">Loading...</div>
        <form id="returnForm" aria-label="Return file form">
          <label for="returnCms">CMS No: <input type="number" id="returnCms" oninput="filterPendingFiles()" aria-label="Search by CMS number"></label>
          <label for="returnTitle">Title: <input type="text" id="returnTitle" oninput="filterPendingFiles()" aria-label="Search by case title"></label>
        </form>
        <div id="pendingFiles" style="margin-top: 10px;">
          <table id="pendingFilesTable" border="1" style="width: 100%; border-collapse: collapse;" aria-label="Pending files table">
            <thead>
              <tr>
                <th scope="col">Select</th>
                <th scope="col">CMS No</th>
                <th scope="col">Title</th>
                <th scope="col">Case Type</th>
                <th scope="col">Delivered To</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <button onclick="bulkReturnFiles()" style="margin-top: 10px;" aria-label="Return selected files">Return Selected</button>
        </div>
      </section>

      <!-- File Fetcher -->
      <section id="fileFetcher" class="screen" aria-labelledby="fileFetcher-heading">
        <h2 id="fileFetcher-heading">File Fetcher</h2>
        <div id="loadingIndicator" class="loading" style="display: none;" aria-live="polite">Loading...</div>
        <div class="fetcher-grid">
          <button class="card card-add-profile" onclick="showProfileForm()" aria-label="Add new profile">Add New Profile</button>
          <button class="card card-search-profiles" onclick="showProfileSearch()" aria-label="Search existing profiles">Search Existing Profiles</button>
          <button class="card card-import" onclick="triggerImport()" aria-label="Import profiles">Import Profiles</button>
          <button class="card card-export" onclick="exportProfiles()" aria-label="Export profiles">Export Profiles</button>
        </div>
        <input type="file" id="profileImport" accept=".json" style="display: none;" onchange="importProfiles()" aria-label="Import profiles file input">
        <form id="profileForm" style="display: none; margin-top: 20px;" aria-label="Profile form">
          <label for="profileType">Profile Type: <span class="required" aria-hidden="true">*</span>
            <select id="profileType" required onchange="toggleProfileFields()" aria-required="true">
              <option value="">Select</option>
              <option value="munshi">Munshi/Clerk</option>
              <option value="advocate">Advocate</option>
              <option value="colleague">Colleague</option>
              <option value="other">Other</option>
            </select>
          </label>
          <div id="profileFields"></div>
          <label for="profilePhoto">Upload Photo: <span id="photoRequired" class="required" aria-hidden="true">*</span>
            <input type="file" id="profilePhoto" accept="image/*" aria-label="Upload profile photo">
          </label>
          <img id="photoPreview" style="display: none; max-width: 200px;" alt="Profile photo preview">
          <div id="photoAdjust"></div>
          <button type="submit" aria-label="Add or update profile">Add/Update Profile</button>
        </form>
        <div id="profileSearchSection" style="display: none; margin-top: 20px;">
          <label for="profileFilterType">Filter by Type:
            <select id="profileFilterType" onchange="renderProfiles()" aria-label="Filter profiles by type">
              <option value="">All</option>
              <option value="munshi">Munshi/Clerk</option>
              <option value="advocate">Advocate</option>
              <option value="colleague">Colleague</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label for="profileSearch">Search:
            <input type="text" id="profileSearch" oninput="renderProfiles()" placeholder="Name, number, chamber..." aria-label="Search profiles by name, number, or chamber">
          </label>
        </div>
        <div id="profileList" style="margin-top: 20px; display: none;">
          <table id="profileTable" border="1" style="width: 100%; border-collapse: collapse;" aria-label="Profiles table">
            <thead>
              <tr>
                <th scope="col">Photo</th>
                <th scope="col">Name</th>
                <th scope="col">Type</th>
                <th scope="col">Cell No</th>
                <th scope="col">Chamber No</th>
                <th scope="col">Files Delivered</th>
                <th scope="col">Pending Files</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Admin -->
      <section id="admin" class="screen active" aria-labelledby="admin-heading">
        <h2 id="admin-heading">Admin</h2>
        <div id="loadingIndicator" class="loading" style="display: none;" aria-live="polite">Saving...</div>
        <div id="setupMessage" style="display: block; color: #0066cc; margin-bottom: 10px;" aria-live="polite">
          Please complete your profile setup to continue using the app.
        </div>
        <div id="savedProfile" style="display: none; background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto;">
          <h3>Saved Profile</h3>
          <table class="profile-table" aria-label="Saved user profile details">
            <tr><th scope="row">Photo</th><td><img id="savedUserPhoto" src="" style="width: 120px; height: 120px; border-radius: 50%; border: 1px solid #ccc; display: none;" alt="User profile photo"></td></tr>
            <tr><th scope="row">Name</th><td><span id="savedClerkName"></span></td></tr>
            <tr><th scope="row">Designation</th><td><span id="savedJudgeName"></span></td></tr>
            <tr><th scope="row">Court</th><td><span id="savedCourtName"></span></td></tr>
            <tr><th scope="row">Mobile</th><td><a id="savedMobile" href="" aria-label="User mobile number"></a></td></tr>
            <tr><th scope="row">Total Files</th><td><span id="totalFiles"></span></td></tr>
            <tr><th scope="row">Total Profiles</th><td><span id="totalProfiles"></span></td></tr>
          </table>
          <button onclick="editUserProfile()" aria-label="Edit user profile">Edit Profile</button>
          <button id="changePinBtn" onclick="showChangePin()" style="display: none;" aria-label="Change PIN">Change PIN</button>
          <h4>Data Management</h4>
          <button onclick="backupData()" aria-label="Backup data to local storage">Backup to Local</button>
          <button onclick="triggerRestore()" aria-label="Restore data from local file">Restore from Local</button>
          <button onclick="signInWithGoogle()" aria-label="Sign in with Google for Drive backup">Sign in with Google</button>
          <button id="backupToDrive" style="display: none;" onclick="backupToDrive()" aria-label="Backup data to Google Drive">Backup to Google Drive</button>
          <button id="restoreFromDrive" style="display: none;" onclick="restoreFromDrive()" aria-label="Restore data from Google Drive">Restore from Google Drive</button>
          <button id="shareBackup" style="display: none;" onclick="showShareBackup()" aria-label="Share backup file">Share Backup</button>
        </div>
        <input type="file" id="dataRestore" accept=".json" style="display: none;" onchange="restoreData()" aria-label="Restore data file input">
        <form id="adminForm" style="display: block;" aria-label="Admin profile setup form">
          <label for="clerkName">Full Name: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="clerkName" required aria-required="true">
          </label>
          <label for="judgeName">Designation: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="judgeName" required aria-required="true">
          </label>
          <label for="courtName">Court Name: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="courtName" required aria-required="true">
          </label>
          <label for="mobile">Mobile Number: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="mobile" required placeholder="0300-1234567" aria-required="true">
          </label>
          <label for="cnic">CNIC: <span class="required" aria-hidden="true">*</span>
            <input type="text" id="cnic" required placeholder="XXXXX-XXXXXXX-X" aria-required="true">
            <span class="tooltip">?
              <span class="tooltiptext">CNIC is required to reset your PIN securely. It is not stored externally.</span>
            </span>
          </label>
          <label for="pin">PIN (4 digits): <span class="required" aria-hidden="true">*</span>
            <input type="password" id="pin" maxlength="4" pattern="\d{4}" required aria-required="true">
          </label>
          <label for="email">Email (for PIN recovery):
            <input type="email" id="email" placeholder="example@domain.com" aria-label="Email for PIN recovery">
          </label>
          <label for="userPhoto">Upload Photo: <span class="required" aria-hidden="true">*</span>
            <input type="file" id="userPhoto" accept="image/*" required aria-required="true">
          </label>
          <img id="userPhotoPreview" style="display: none; max-width: 200px;" alt="User photo preview">
          <div id="userPhotoAdjust"></div>
          <label><input type="checkbox" id="agreeTerms" aria-label="Agree to terms and privacy policy"> I agree to the <a href="#" onclick="showDisclaimerModal()" aria-label="View terms and privacy policy">terms and privacy policy</a>.</label>
          <button type="submit" id="saveProfileBtn" disabled aria-label="Save profile">Save</button>
        </form>
      </section>

      <!-- Developers Disclaimer -->
      <section id="developersDisclaimer" class="screen" aria-labelledby="disclaimer-heading">
        <h2 id="disclaimer-heading">Developers Disclaimer</h2>
        <div id="disclaimerContent">
          <p>This Court File Tracker (CFT) PWA is developed to assist court clerks and judiciary staff in managing file records efficiently. It is not an official judiciary tool. Users are responsible for ensuring data accuracy and compliance with legal standards.</p>
          <p>Developer: [Your Name]</p>
          <p>Contact: [Your Email or Placeholder]</p>
          <p>Version: 1.0.0</p>
          <p>Last Updated: May 15, 2025</p>
        </div>
      </section>

      <!-- PIN Prompt Modal -->
      <div id="pinModal" class="modal" onclick="closeModalIfOutside(event, 'pinModal')" role="dialog" aria-labelledby="pinModal-heading" aria-modal="true">
        <div class="modal-content">
          <h3 id="pinModal-heading">Enter PIN</h3>
          <input type="password" id="pinInput" maxlength="4" pattern="\d{4}" style="padding: 8px; width: 100%;" aria-label="Enter 4-digit PIN" required>
          <button onclick="submitPin()" aria-label="Submit PIN">Submit</button>
        </div>
      </div>

      <!-- Change PIN Modal -->
      <div id="changePinModal" class="modal" onclick="closeModalIfOutside(event, 'changePinModal')" role="dialog" aria-labelledby="changePinModal-heading" aria-modal="true">
        <div class="modal-content">
          <h3 id="changePinModal-heading">Change PIN</h3>
          <label for="resetCnic">CNIC or Email:
            <input type="text" id="resetCnic" placeholder="Enter CNIC or Email" required aria-required="true">
          </label>
          <label for="resetPin">New PIN:
            <input type="password" id="resetPin" maxlength="4" pattern="\d{4}" required aria-required="true">
          </label>
          <button onclick="changePin()" aria-label="Change PIN">Change</button>
          <button onclick="hideChangePin()" aria-label="Cancel PIN change">Cancel</button>
        </div>
      </div>

      <!-- Disclaimer Modal -->
      <div id="disclaimerModal" class="modal" onclick="closeModalIfOutside(event, 'disclaimerModal')" role="dialog" aria-labelledby="disclaimerModal-heading" aria-modal="true">
        <div class="modal-content">
          <h3 id="disclaimerModal-heading">Disclaimer & Privacy Policy</h3>
          <p><strong>Disclaimer:</strong> This is not an official judiciary tool. It is designed for the convenience of clerks and judiciary staff to digitize record-keeping. Users are responsible for their use of this tool.</p>
          <p><strong>Privacy Policy:</strong> Your data is saved locally in your browser or synced to your Google Drive via OAuth API. No data is stored externally by the app.</p>
          <button onclick="document.getElementById('disclaimerModal').style.display='none';" aria-label="Close disclaimer modal">Close</button>
        </div>
      </div>

      <!-- Profile Details Modal -->
      <div id="profileModal" class="modal" onclick="closeModalIfOutside(event, 'profileModal')" role="dialog" aria-labelledby="profileModalTitle" aria-modal="true">
        <div class="modal-content">
          <h3 id="profileModalTitle"></h3>
          <div style="position: relative; display: inline-block;">
            <img id="profileModalPhoto" src="" style="width: 100px; height: 100px; border-radius: 50%; border: 1px solid #ccc; margin-bottom: 10px; display: none;" alt="Profile photo">
            <div class="photo-zoom" style="display: none; position: absolute; top: 0; left: 110px; z-index: 10;">
              <img id="profileModalPhotoZoom" src="" style="width: 200px; height: 200px; border-radius: 10px; border: 2px solid #ccc;" alt="Zoomed profile photo">
            </div>
          </div>
          <table id="profileModalTable" class="profile-modal-table" aria-label="Profile details"></table>
          <button onclick="closeProfileModal()" aria-label="Close profile details">Close</button>
        </div>
      </div>

      <!-- Share Backup Modal -->
      <div id="shareBackupModal" class="modal" onclick="closeModalIfOutside(event, 'shareBackupModal')" role="dialog" aria-labelledby="shareBackupModal-heading" aria-modal="true">
        <div class="modal-content">
          <h3 id="shareBackupModal-heading">Share Backup</h3>
          <label for="backupFiles">Select Backup:
            <select id="backupFiles" required aria-required="true" aria-label="Select backup file"></select>
          </label>
          <label for="shareEmail">Recipient Email:
            <input type="email" id="shareEmail" placeholder="recipient@example.com" required aria-required="true">
          </label>
          <button onclick="shareBackup()" aria-label="Share backup">Share</button>
          <button onclick="hideShareBackup()" aria-label="Cancel sharing backup">Cancel</button>
        </div>
      </div>

      <!-- Toast Notification -->
      <div id="toast" class="toast" style="display: none;" role="alert" aria-live="assertive"></div>

      <!-- Install Button for PWA -->
      <button id="installButton" style="display: none; margin: 10px; padding: 10px; background-color: #28a745;" aria-label="Install Court File Tracker app">Install App</button>
    </main>
  </div>

  <!-- Application Script -->
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log('Service Worker registered'))
          .catch(err => console.error('Service Worker error:', err));
      });
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installButton').style.display = 'block';
      console.log('PWA install prompt ready.');
    });
  </script>
</body>
</html>
